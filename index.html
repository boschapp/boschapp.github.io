
<!DOCTYPE html>
<html>
<head>
<meta name="generator" content="HTML Tidy for Windows (vers 15 August 2017), see www.w3.org">
<meta charset='utf-8'>

<title>Bosch Development Tool Booking System</title>

<link href='./css/jquery-ui.min.css' rel='stylesheet' type="text/css">
<link href='./css/fullcalendar/3.9.0/fullcalendar.css' rel='stylesheet' type="text/css">
<link href='./css/fullcalendar/3.9.0/fullcalendar.print.css' rel='stylesheet' media='print' type="text/css">
<link href='./css/fullcalendar/fullcalendar-scheduler/1.9.4/scheduler.css' rel='stylesheet' type="text/css">
<link href="./js/jquery/jsTree/3.3.8/style.min.css" rel="stylesheet" type="text/css">


<!--
<link href='./css/bootstrap.min.css' rel='stylesheet' type="text/css">
-->
<link href='./css/bootstrap/4.3.1/css/bootstrap.min.css' rel='stylesheet' type="text/css">
<link href="./css/font/css/open-iconic-bootstrap.min.css" rel="stylesheet">
<link href='./css/jquery.datetimepicker.min.css' rel='stylesheet' type="text/css">

<script src='./js/moment.min.js' type="text/javascript"></script>
<script src='./js/jquery/jquery.js' type="text/javascript"></script>
<script src='./js/jquery/jquery-ui.min.js' type="text/javascript"></script>
<script src='./js/js.cookie.js'></script>
<script src='./js/jquery/fullcalendar/3.9.0/fullcalendar.min.js' type="text/javascript"></script>
<script src='./js/jquery/fullcalendar/fullcalendar-scheduler/1.9.4/scheduler.min.js' type="text/javascript"></script>
<script src='./js/jquery/datetimepicker/jquery.datetimepicker.full.min.js'></script>
<script src='./js/jquery/jsTree/3.3.8/jstree.min.js' type="text/javascript"></script>

<!--
<script src='./js/popper.js/1.14.4/popper.min.js' type="text/javascript"></script>
<script src='./js/bootstrap/4.1.3/js/bootstrap.min.js' type="text/javascript"></script>
-->
<script src='./js/popper.js/1.14.7/popper.min.js' type="text/javascript"></script>
<script src='./js/bootstrap/4.3.1/js/bootstrap.min.js' type="text/javascript"></script>

<script src='fe_functions.inc.js' type="text/javascript"></script>

<link href='./css/customize/customize_view.css' rel='stylesheet' type="text/css">


﻿ 

<script type="text/javascript">

  // ui-tooltipとbootstrapのtooltipが競合して動かなくなるのを防ぐため
  $.widget.bridge('uibutton', $.ui.button);
  $.widget.bridge('uitooltip', $.ui.tooltip);

  // 初期描画時のみ実行させるためのフラグ
  var initialized = true;

  // 任意の日付を選択できるようdatepickerを実装する
  $(document).ready(function() {
    $('#datepicker').datepicker({
//        $('#datepict1').datepicker({
//			current: today,
//			current: currentDate,
//            current: $('#calendar').fullCalendar('getDate');,
      showOn: "both",
      buttonImage: "./images/calendar.png",
      // ここからDatepickerの各種オプション
      buttonImageOnly: true,
      showOtherMonths: true,
      changeYear: true,
      changeMonth: true,
      dateFormat: 'yy/mm/dd',
      // datepickerから日付が選択された場合
			onSelect: function(select_date, inst) {
        // fullcalendar側に日付を転送する
  			$('#calendar').fullCalendar('gotoDate', select_date);
			}
    })
  });



//  $(function() {
  // HTMLが完全に読み込まれてから、JavaScriptを実行する
  $(document).ready(function() {

    $('#calendar').fullCalendar({
      schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source', // license

      // jQuery UI theme
      theme: false,
      // themeSystem: 'bootstrap3',

      //初期表示時に子階層を展開しない
      resourcesInitiallyExpanded: false,

      // 表示開始時刻
      scrollTime: '00:00',
      selectable: true,
      selectHelper: true,
      // スケジュールの編集を可能
      editable: true,

      // 土日曜を表示
      weekends: true,
      // 週モード (fixed, liquid, variable)
      weekMode: 'fixed',
      // 時間の表示フォーマット
	    timeFormat: 'HH(:mm)',

	    // 高さの初期設定(px)
	    //  垂直スクロールバーが二重にならないサイズを調整する（カレンダー表示部をスクロール対象外とするため）
      //  ヘッダ部分に情報を追加した場合には、サイズの調整が必要
	    height: window.innerHeight - 100,
	    // ウィンドのサイズを変更すると、windowResizeが発動
	    //   ここにカレンダーのオプションを更新する処理を実装
	    windowResize: function () {
		    $('#calendar').fullCalendar('option', 'height', window.innerHeight - 100);
	    },

      // コンテンツの高さ(px)
      // contentHeight: 600,

      // カレンダーの縦横比(比率が大きくなると高さが縮む)
      aspectRatio: 1.8,

      // タイトルの書式
      // titleFormat: {
      //    month: 'yyyy年M月',                             // 2018年9月
      //    week: "yyyy年M月d日{ ～ }{[yyyy年]}{[M月]d日}",  // 2018年9月7日 ～ 13日
      //    day: "yyyy年M月d日'('ddd')'"                    // 2018年9月7日(火)
      // },

      // カレンダー上部のボタンとタイトルを定義
      header: {
        left: 'today prev,next',
        center: 'title',
        right: 'timelineDay timeline7Days timeline30Days timeline1Year'
      },

        //ヘッダーの書式
        //　columnFormat: {
        //    month: 'ddd', // 月
        //    week: 'D[(]ddd[)]', // 7(月)
        //    day: 'D[(]ddd[)]' // 7(月)
        //　},

      // 初期表示ビュー
      //  前回に表示していた時間枠でビューを表示する（Cookieから読込）
      //  Cookieに情報がない場合には、'7Days'で表示する
   	  defaultView: Cookies.get( 'fullcalendar_defaultView' ) || 'timeline7Days',

      // 今日の日付からカレンダーを表示する
      firstDay: "today",
/*
      firstDay: function(){
        // 1年間表示の場合は、当日の3カ月前から表示領域を確保する
        console.log( "fullcalendar_defaultView" + Cookies.get( 'fullcalendar_defaultView' ) );
        if( Cookies.get( 'fullcalendar_defaultView' ) == 'timeline1Year' ){
          //var specified_data = moment().('yy/mm/dd');
          var specified_data = moment( today );
          //$('#calendar').fullCalendar('option', 'firstDay', moment().add( 3, 'months' ) );
          $('#calendar').fullCalendar('option', 'firstDay', 'today' );
          //console.log( "timeline1Year: " + moment().add( 3, 'months' ) );
          console.log( specified_data );
        }
        // それ以外
        else{
          $('#calendar').fullCalendar('option', 'firstDay', 'today' );
        }

      },
*/

//--- 新しい時間表示枠がレンダリングされたとき、またはビューの種類が切り替わるときにトリガーされる
//
      viewRender: function( view ) {

      // 選択された新しい時間表示枠をCookieに収納（60日間）
      Cookies.set( 'fullcalendar_defaultView', view.name, { expires: 60 });

      // 年表示で初回のみ今日から３カ月前を表示させる
      // 初回を識別するための手段が必要 initializedフラグ
      if( view.name == 'timeline1Year' && initialized ){
        console.log( "defaultView: " +  view.name );
        // 今日から３カ月前の1日目をカレンダー表示の起点とする
        $('#calendar').fullCalendar( 'gotoDate', moment().subtract( 3, 'months' ) );
        console.log( initialized );
      }

      initialized = false;

          // ビューが再描画されると、全てのリソース階層がクローズされてしまう
          // ビューが再描画される前に展開されていたリソース階層をCookieの情報を元に再展開する
          var previous_expand_rows = '';
          previous_expand_rows = Cookies.get('fullcalendar_resource_expand_ids');
          console.log( "viewRender -> previous_expand_rows: " + previous_expand_rows );

          var expand_resource_id = '';
          var tr_resource_id = '';

          // 取得したCookieの文字列が空でないか確認
          if( previous_expand_rows !== undefined ){
            // 展開を実施出来たリソースIDを格納する
            var success_expand_rows_array = [];

            // resourceRenderイベント内のclick処理でCookieを更新するため、一度削除する
            Cookies.remove( 'fullcalendar_resource_expand_ids' );

            // 取得したCookieの文字列をカンマで分割して、展開するリソースIDを全て取り出す
            previous_expand_rows.split(',').forEach( function( expand_resource_id ) {

              tr_resource_id = 'tr[data-resource-id=\"' + expand_resource_id + '\"]';
              console.log( "check_resource_id: " + tr_resource_id );

              // 展開すべきリソース <tr> の指定属性が存在した場合
              // 存在が確認できなかったリソースIDは Cookieから除外する
              // if ( document.getElementById( tr_resource_id ) != null ){ // これだとチェック出来ない
              if ( $( tr_resource_id )[0] ){

                // 取得したリソースID毎にリソース階層を展開する
                // 暫定措置 on( 'click' )でイベントが発火しない
                $( tr_resource_id ).find( '.fc-expander' ).click();
//                $( tr_resource_id ).find( '.fc-expander' ).on( 'click', function() {
//                $( tr_resource_id ).find( '.fc-expander' ).on( 'click', 'div.fc-content', function() {
//                  console.log( "viewRender: clicked " + expand_resource_id );
//                });
//                  $( tr_resource_id ).find( '.fc-icon' ).removeClass( 'fc-icon-right-triangle' );
//                  $( tr_resource_id ).find( '.fc-icon' ).addClass( 'fc-icon-down-triangle' );

                // 展開されたリソースIDを配列の末尾に格納する
                /// success_expand_rows_array.push( expand_resource_id );

              }

            }); // ~ previous_expand_rows.split(',').forEach( function( expand_resource_id )
          } // ~ if( previous_expand_rows !== undefined )

        // リソースを指定して展開or収納させるための表記例
        // $('tr[data-resource-id="100000003"]').find('.fc-expander').click();

        // リソース展開後の最新の行数を取得する -> 使用しない
        // 指定したい<tbody>には、クラス名が定義されていないので、4番目（eq(3)）の<tbody>として指定する
        // var current_rows = $('tbody').eq(3).prop('rows').length;


        // 時間枠が変更された場合には、ビュー画面の開始日をdatepickerに反映させる
        // datepickerに日付を転送する場合には、YYYY/MM/DDフォーマットに変換する
        $('#datepicker').datepicker("setDate", $('#calendar').fullCalendar('getView').start.format('YYYY/MM/DD'));


        // 表示されている時間枠に適合するイベント（予約）情報を取得する
        // 表示されているビューの時間枠の始日時と終日時をISO拡張フォーマットで取得する
        // var start = $.fullCalendar.moment(view.start, "YYYY-MM-DDThhmmssZ");
        // var end = $.fullCalendar.moment(view.end, "YYYY-MM-DDThhmmssZ");

        // DB内の日時フォーマットに併せてunixtimeに変換する
        // var start_post = moment( start ).format('X');
        // var end_post = moment( end ).format('X');
        // console.log( start_post );
        // console.log( end_post );

        // 表示されているビューの時間枠の始日時と終日時を unixtimeで取得する
        var start = $( '#calendar' ).fullCalendar( 'getView' ).start.format( 'X' );
        var end = $( '#calendar' ).fullCalendar( 'getView' ).end.format( 'X' );
        // 利用者のタイムゾーンを取得する（例: +09:00）
        var time_zone = moment().format('Z');
        console.log( "Time zone: " + time_zone );

        // サーバーからイベントデータをjsonフォーマットで取得
        $.ajax({
			    url: "events_load.php",
			    dataType: 'json',
			    type: "post",
			    data: {
            // 現在表示されている時間枠の始日時と終日時, 利用者のタイムゾーンを転送する
				    "start": start,
            "end": end,
            "time_zone": time_zone
			    },
			  success: function(EventSource) {
          // カレンダーから既存のイベントを削除
				  $('#calendar').fullCalendar('removeEvents');
          // DBから取得した新しいイベントソースを動的に追加
				  $('#calendar').fullCalendar('addEventSource', EventSource);
			  }
		  });

		  },  // ~ viewRender

//--- リソースのDOMを操作するためのフック
//    最初の引数はリソースオブジェクト
//    2番目の引数は、リソースの名前（jQueryオブジェクト）を保持する<td>または<th>
//    3番目の引数は、リソースのイベント（jQueryオブジェクト）を視覚的に含む要素を保持
//	    resourceRender: function(resourceObj, labelTds, bodyTds) {
      resourceRender: function(resourceObj, $td) {

        //-- リソースの親要素の展開処理
        // 展開されたリソース階層のidをCookieに収納する

        // clickのイベントハンドラが重複されるのを防止
        $( document ).off( 'click', '.fc-expander' );

        // clickされたリソースのイベントハンドラをフック
        $( document ).on( 'click', '.fc-expander', function(){

          // clickされたリソースIDを取得する
          var expand_resource_id = $( this ).closest( 'tr' ).attr( 'data-resource-id' );

          // clickされたリソースIDが親要素であることを確認する
          if ( expand_resource_id > 100000000 ){

            // 引数に渡された関数は、HTMLのDOM構築が完了した時点で呼ばれる
            // click後、リソースの階層が描画された後に、リソース展開状態を記録する
            $( document ).ready( function(){

              // Cookieから取得したリソース展開状態を配列に格納
              var previous_expand_rows_array = [];
              // Click処理実行後のリソース展開状態を配列に格納
              var new_expand_rows_array = [];

              var new_expand_rows = '';
              var resource_id = '';

              // click以前のリソース展開状態を Cookieから取得する
              var previous_expand_rows = Cookies.get( 'fullcalendar_resource_expand_ids' );
              console.log( "resourceRender -> previous expand rows: ", previous_expand_rows );

              // 取得したCookieの文字列が空でないか確認
              if ( previous_expand_rows !== undefined ){
                // 展開を実施出来たリソースIDを格納する
                // 取得したCookieの文字列をカンマで分割して、展開済リソースIDを全て取り出す
                previous_expand_rows.split(',').forEach( function( resource_id ){

                  // 展開済リソースIDを配列の末尾に格納する
                  previous_expand_rows_array.push( resource_id );
                });

                // 新たにckickされたリソースIDが展開済リソースIDに含まれているか確認する
                // Cookie内にリソースIDが既存の場合 -> 親要素が閉じられた
                if ( previous_expand_rows_array.indexOf( expand_resource_id ) >= 0 ){
                  // 配列内からclickされたリソースIDを削除する
                  new_expand_rows_array = previous_expand_rows_array.filter( n => n !== expand_resource_id );

                  // 全ての親要素が閉じられた状態
                  if ( new_expand_rows_array.length == 0 ){
                    new_expand_rows = '';
                    console.log( "resourceRender -> empty" );
                  }
                  else{
                    // 削除された配列をカンマ区切り文字列に変換する
                    new_expand_rows = new_expand_rows_array.join( ',' );
                    console.log( "resourceRender -> deleted" );
                  }
                }
                // Cookie内にclickされたリソースIDが未存の場合 -> 親要素が展開された
                else{
                  // 展開済リソースIDを配列の末尾に追加する
                  previous_expand_rows_array.push( expand_resource_id );
                  // 展開済リソースIDの配列を昇順にソートする
                  previous_expand_rows_array.sort();

                  // 削除された配列をカンマ区切り文字列に変換する
                  new_expand_rows = previous_expand_rows_array.join( ',' );
                  console.log( "resourceRender -> added" );
                }
              } // ~ if ( previous_expand_rows !== undefined )

              // Cookieに展開済リソースIDの記録が未存の場合
              else{
                // 新たにclickされたリソースIDを1件登録する
                new_expand_rows = expand_resource_id;
                console.log( "resourceRender -> newly added" );
              }

            //  最新のリソース状態に描画された後の行数をCookieに収納
            Cookies.set( 'fullcalendar_resource_expand_ids', new_expand_rows, {expires: 60} );

            // 確認用
            console.log( "Resource expand rows: ", new_expand_rows );

            }); // ~ $(document).ready(function()

          } // ~ if ( expand_resource_id > 100000000 )

        }); // ~  $(document).on('click','.fc-expander',function()




//    },  // ~ resourceRender: function(resourceObj, labelTds, bodyTds)

      // リソースの上にマウスオーバーされた際に、詳細な情報を表示する
//      resourceRender: function(resourceObj, $td) {
//      function(resourceObj, $td) {
//          $td.eq(0).find('.fc-cell-content').popover({ // 枠内全てがマウスオーバーの対象になるためクリックがトリガされない
        // リソースのテキスト表示部分をマウスオーバーの対象とする
/*
        $td.eq(0).find('.fc-cell-text').mouseover( function(){
          // 子の要素の場合のみ、popoverを有効とする
          var resource_id = parseInt(resourceObj.id);
          console.log( "popover: " + resource_id );
          if ( resource_id < 100000000 ){

            $td.eq(0).find('.fc-cell-text').popover({

              // title: resourceObj.title,
              // title: 'title',
              title: "",
              html: true,
              // placement: 'right',
              // placement: 'bottom',
              placement: 'auto',
              animation: false,
              // container: '#calendar',
              // 最前面に表示するために指定する
              // container: 'body',
              container: '.fullcalendar_body',
              trigger: 'hover',
              // trigger: 'manual',
              // trigger: 'click',
              // popoverのフリッカー対策
              //delay: { show: 200, hide: 0 },
              // delay: { show: 500, hide: 0 },
              // content: resourceObj.name,
              // content: resourceObj.address,
              content: function(){
                var id = parseInt( resourceObj.id );
                if ( id < 100000000 ){
                  return resourceObj.content;
                }
                // 親階層にはpopoverを表示させない
                else{
                  // popoverのcontentにnullを返すとpopoverが表示されなく出来る -> エラーとなる
                  console.log( "No popover: ");
                  // return "";
                  // return undefined;
                  // return null;
                }
              }
            }); // ~ $td.eq(0).find('.fc-cell-text').popover({
          }
        }); // ~ $td.eq(0).find('.fc-cell-text').mouseover(function(){
*/

        // リソースの枠がクリックされた場合に、予約用のモーダルを開く
        // clickのイベントハンドラが重複されるのを防止
        $( document ).off( 'click', '.fc-cell-content' );
        $td.eq( 0 ).find( '.fc-cell-content' ).on( "click", function(){
//          $td.eq(0).find('.fc-cell-content').on("click", function(e){
//          $td.eq(0).find('.fc-cell-content').on("show.bs.modal", function(e) {
//          $td.eq(0).find('.fc-cell-content'){
//            var link = $(e.relatedTarget); //クリックしたセルのオブジェクトデータ
//            $(this).find(".modal-content").load(link.attr("data-href"));
//          console.log(e.target);
          // 親階層のクリック時にはモーダルは表示させない
          var id = parseInt(resourceObj.id);
            if ( id < 100000000 ){
              console.log("modaled!!: resourceID: " + resourceObj.id );

              open_entry_modal( resourceObj.id );
/*
              //取得するリソースIDをpostで転送する
              $.post({
                url: 'resource_load.php',
                data:{
                  'resource_id': resourceObj.id
                },
                dataType: 'json',
              }).done( function( data ){

                console.log( data );
              // 非表示データとして選択されたリソースIDを転送する
              $( '#entryModal #userid-text' ).val( "< ?php echo $_SESSION['user_name'] ?>" );
              $( '#entryModal #proxyid-text' ).val( "< ?php echo $_SESSION['user_name'] ?>" );
              $( '#entryModal #resourceid-text' ).val( resourceObj.id );

              // モーダル用の表示データとして、リソース名を転送する
              $( '#entryModal #resourcename-text').val( resourceObj.name );
              $( '#entryModal #username-text').val( "< ?php echo $_SESSION['user_displayname'] ?>" );

              // 必須入力項目のテキストボックスをリセットする（初回時にゴミデータが入る可能性があるため）
              reset_textbox_val( '#entryModal #overview-text' );
              reset_textbox_val( '#entryModal #description-text' );
              reset_textbox_val( '#entryModal #event-to-datetime' );

              // DBから取得したjsonオブジェクトから1件のリソースに関する情報を転送する
              $( '#entryModal #admin-no-text').val( data[0]["admin_no"] );
              $( '#entryModal #asset-no-text').val( data[0]["asset_no"] );
              $( '#entryModal #location-text').val( data[0]["location"] );
              $( '#entryModal #address-text').val( data[0]["address"] );
              $( '#entryModal #accessories-text').val( data[0]["accessories"] );
              $( '#entryModal #support-info-text').val( data[0]["support_info"] );
              $( '#entryModal #contact-text').val( data[0]["admin_email"] );

              // 表示されているビューの時間枠の始日時をISO拡張フォーマットで取得する
//              var from_datetime = $.fullCalendar.moment(view.start, "YYYY-MM-DDThhmmssZ");
//              var from_datetime = $.fullCalendar.moment(view.start, "YYYY/MM/DD Thh:mmZ");
*/
              // 表示されているビューの時間枠の始日時を取得する
              // 予約開始期間の初期値をセットする
              // var from_datetime = $( '#calendar' ).fullCalendar( 'getView' ).start.format( 'YYYY/MM/DD HH:mm' );
              var from_datetime = $( '#calendar' ).fullCalendar( 'getView' ).start.format( 'YYYY/MM/DD' );
              from_datetime += " 13:00";
              $( '#entryModal #from-datetime' ).val( from_datetime );

              // 新規予約用のダイアログオープン時の表示&非表示とする要素を設定
              entryModal_initial_display();

              // モーダルオープン
              $( '#entryModal' ).modal( 'show' );

//              });

            }

          }); // ~  $td.eq( 0 ).find( '.fc-cell-content' ).on( "click", function(){


/*
        $(document).on('mouseover', '#example', function(){
          $(this).popover('show');
        });
        $(document).on('mouseleave', '#example', function(){
          $(this).popover('hide');
        });
*/

        console.log( resourceObj );



    },  //  ~ resourceRender: function(resourceObj, $td)


//--- イベントのDOMを変更するためのフック
//    最初の引数はイベントオブジェクト
//    2番目の引数は、レンダリングに使用される、新しく作成されたjQuery要素（予約期間やタイトルテキストを含む）
      eventRender: function( eventObj, $el ) {

//      eventAfterRenderの場合、新しく階層展開サレタイベントでは、発火しない
//      eventAfterRender: function(eventObj, $el) {

        // ポップオーバーがレンダリングしてはならないフラグをスクロールイベントに追加する
        /*
        if( window.eventScrolling ){
          console.log( "Scroll chk" );
          return;

        }
        */

//        $el.mousemove(function(e) {
//          if (e.which === 1) {
//            $('.popover.fade.top').remove();
//           }
//        });

        $( ".popover" ).remove();

        $el.popover({
          title: eventObj.title,
          html: true,
          content: eventObj.content,
          trigger: 'hover',
//          placement: 'bottom',
          placement: 'auto',
//          delay: { "show": 500, "hide": 100 },
//          container: 'body'
          container: '.fullcalendar_body'
//          container: '.fc-body'
        });

      },  //  ~ eventRender: function(eventObj, $el) {

//--- イベント系 Popoverの不具合対策
      eventResize: function( event, delta, revertFunc ) {
        $( '.popover.fade.top' ).remove();
        console.log( "eventResize:" );
      },


//--- イベントのクリックをフック
//    最初の引数はクリックされたイベントの情報（予約期間やタイトルテキスト）
//    2番目の引数は、レンダリングに使用される、新しく作成されたjQuery要素（予約期間やタイトルテキストを含む）
//    一般ユーザ（予約者、管理者以外）および、期間超過のイベント（管理者以外）がクリックされた場合は、モーダル表示
//    権限保持者によるクリックの場合は、編集可能なモーダル表示

      eventClick: function( event ) {

        // 利用者のタイムゾーンを取得する（例: +09:00）
        var time_zone = moment().format('Z');
        console.log( "Time zone: " + time_zone );


        // クリックされたイベントの開始と終了日時, イベントIDを取得する
        // var start = $.fullCalendar.formatDate( event.start, "YYYY/MM/DD HH:mm" );
        // var end = $.fullCalendar.formatDate( event.end, "YYYY/MM/DD HH:mm" );

        //取得するリソースIDをpostで転送する
        $.post({
          url: 'event_load.php',
          data:{
              'event_id': event.id,
              "time_zone": time_zone
          },
          dataType: 'json',
        }).done( function( data ){

          console.log( data );

          // イベントモーダル内の非表示データ属性をリセットする
          eventModal_all_data_method_reset();

          // 取得したイベント情報を元に、eventModal をデザインする
          create_event_modal( data[0] );

          // モーダル用の表示データとして、表示用のイベント情報から既得情報を転送する
          // $('#eventModal #from-datetime').val( start );
          // $('#eventModal #to-datetime').val( end );

          // イベントモーダルをオープンする
          // オープン時のイベントは、$( '#eventModal' ).on( 'show.bs.modal', function ()で処理する
          $( '#eventModal' ).modal( 'show' );
        });
      },


      nowIndicator: true,
      // navLinks: true,

      views: {
        timelineDay: {
          // スロットの時間の書式
//          axisFormat: 'H:mm',
//          axisFormat: 'H',
//          columnFormat: 'h',
          // スロットの幅(px)
          slotWidth: 10,
          // カレンダーの表示グリッド 単位
          slotDuration: '01:00:00',
          // スロットの時間表示の書式
          slotLabelFormat : 'H:mm',
          // イベントの貼り付けグリッド 単位
          snapDuration: '00:05:00'
        },
        timeline7Days: {
          buttonText: '7Days',
          type: 'timeline',
          slotWidth: 10,
          slotDuration: '06:00:00',
          snapDuration: '00:15:00',
          slotLabelFormat : 'M/D ddd',
          // 表示期間 日数
//          dayCount: 7
          duration: { days: 7 }
        },
        timeline30Days: {
          buttonText: '30Days',
          type: 'timeline',
          slotWidth: 6,
//          axisFormat: 'dd',
//          slotDuration: '01.00:00:00',
          slotDuration: '12:00:00',
          snapDuration: '04:00:00',
//          slotLabelInterval: { weeks: 1 },
          slotLabelFormat : 'D',
          duration: { days: 30 },
//          eventLimit: 4
//          dayCount: 30
        },
        timeline1Year: {
          buttonText: '1Year',
          dateIncrement: { years: 1 },
          type: 'timeline',
//          slotWidth: 20,
          slotWidth: 4,
//          slotDuration: '10.00:00:00' // カレンダーの表示グリッド単位
            // 表示開始日を月初日とする
            dateAlignment: 'month',
            slotLabelInterval: { months: 1 },
//            slotDuration: { months: 1 },
//            slotDuration: { weeks: 1 },
            slotDuration: '01.00:00:00',
            snapDuration: '12:00:00',
//            snapDuration: '01.00:00:00',
            duration: { years: 1 },
            eventLimit: 3
//            duration: { days: 365 }
//            duration: { months: 12 }
//            function(){
//              $('.fc-sun').removeClass('background-color');
//              $('th').find('.fc-sun').removeClass('background-color','#fff0f0');
//            }
        }
      },



	  refetchResourcesOnNavigate: true,
    resourceAreaWidth: '25%',


//--- リソース表示列の設定
//
    resourceColumns: [
      {
        labelText: 'Resource',
        field: 'name'
      },
      {
        labelText: 'Description',
        field: 'eq_short_info'
      }
      ],



//--- サーバーからリソースデータをjsonフォーマットで取得
//　取得条件として（ 管理者権限, ロケーション ）を付与する
    resources: {
      url: 'resources_load.php',
      dataType: 'json',
      type: 'POST',
      // POSTメソッドで渡すデータは、dataプロパティで設定
      data: {
        // 管理者モード (true) or 一般ユーザモード (false)
        // admin_mode: true,
        // リソースのロケーションをフィルタリングする（Cookie情報を取得する）
        locations: function(){ return get_location_selected_filter(); },
        // リソースの親階層をフィルタリングする（Cookie情報を取得する）
        resources: function(){ return get_resource_selected_filter(); }
      },
      error: function(){
        // エラー時の表示例（未使用 未定義）
        // $('#script-warning').show();
      }
    },





      // イベントをドラッグを禁止する
      droppable: false,
      // イベントの期間をマウス操作での編集を禁止する
      editable: false,

//      eventOverlap: false,
      // 同じ枠内へのイベント表示数に上限を設ける
//      eventLimit: 3,
      // イベント件数が上限を超えた場合、ポップオーバーで確認出来るようにする
//      eventLimitClick: 'popover',


/*
    events: { // you can also specify a plain string like 'json/resources.json'
      url: 'event_test_data.json',
      error: function() {
        $('#script-warning').show();
      }
    }
*/

/*
    // サーバーからリソースデータをjsonフォーマットで取得
    events: {
      url: 'events_load.php',
      dataType: 'json',
      type: 'POST',
      // POSTメソッドで渡すデータは、dataプロパティで設定
      data: {
        // 管理者モード (true) or 一般ユーザモード (false)
        admin_mode: true,
        // リソースのロケーションのフィルタ
        locations: ''
      },
      error: function () {
      }
    },
*/

//    events: 'events_load.php',
/*
    selectable:true,
    selectHelper:true,
    select: function(start, end, allDay)
    {
     var title = prompt("Enter Event Title");
     if(title)
     {
      var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss"); //  廃止
      var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
      $.ajax({
       url:"insert.php",
       type:"POST",
       data:{title:title, start:start, end:end},
       success:function()
       {
        calendar.fullCalendar('refetchEvents');
        alert("Added Successfully");
       }
      })
     }
    },
*/

//      eventRender:{}

/*
    editable:true,
    eventResize:function(event)
    {
     var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
     var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
     var title = event.title;
     var id = event.id;
     $.ajax({
      url:"update.php",
      type:"POST",
      data:{title:title, start:start, end:end, id:id},
      success:function(){
       calendar.fullCalendar('refetchEvents');
       alert('Event Update');
      }
     })
    },

    eventDrop:function(event)
    {
     var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
     var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
     var title = event.title;
     var id = event.id;
     $.ajax({
      url:"update.php",
      type:"POST",
      data:{title:title, start:start, end:end, id:id},
      success:function()
      {
       calendar.fullCalendar('refetchEvents');
       alert("Event Updated");
      }
     });
    },


*/


});
}); /* ~  $(document).ready(function() { */

/*
//        var date = $.cookie("stored_date");  //　現在カレンダーが選択している日にちをCookieに保存
        var date = Cookies.get('stored_date');  //　現在カレンダーが選択している日にちをCookieに保存

        // dateが空値だったら〔つまり、初めてのアクセスの場合〕、現在の日にちに設定、それ以外はCookieに
        // 保存された日にちを使う。
        if(date){
            $('#calendar').fullCalendar('gotoDate', date );
        } else {
            $('#calendar').fullCalendar('today');
        }

        // カレンダーの移動ボタンが押されたときに日にちをCookieに保存する処理
        $('.fc-prev-button,.fc-next-button,.fc-today-button').click(function(){
            var date = $('#calendar').fullCalendar('getDate');
            Cookies.set('stored_date', date, {expires: 1});           // Cookieに保存する期間は1日とする。
        });


  });
*/




  // popoverで表示されるcontentを取得する <-- 使っていない
/*
  function get_content( id ) {

    var content_data = '';
    $.ajax({
      url:"resource_content_load.php",
      method:"POST",
      async:false,
      // POSTメソッドで渡すデータは、dataプロパティで設定
      data:{id:id},
      success:function(data){
        content_data = data;
      }
    });
    return content_data;

//    return "test";
  }
*/


/*
  $('#submitButton').on('click', function(e){
            // We don't want this to act as a link so cancel the link action
            e.preventDefault();

            doSubmit();
          });


  function doSubmit(){
    $("#createEventModal").modal('hide');
    $("#calendar").fullCalendar('renderEvent',
      {
        title: $('#eventName').val(),
        start: new Date($('#eventDueDate').val()),
      },
      true);
  }
*/

</script>


<style type="text/css">

  body {
    margin: 5px 10px;
    padding: 0;
    font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
    font-size: 14px;
  }

  #calendar {
    /* リソース表示部を含む全エリア表示領域幅 */
    /* max-width: 900px; */
    margin: 0 auto;
  }

</style>


<title>Bosch Development Tool Booking System</title>
</head>
<body>
<div class='fullcalendar_body'>

<table class="personal_header">
<tr>
<td class="date_select_header" ALIGN="LEFT">Date select: <input type="text" id="datepicker"></td>
<td class="custom_button_layout">
<div class="custom_button_style">
      <button type="button" class="btn btn-info" id="resource-button">Resource</button>
  <button type="button" class="btn btn-info" id="location-button">Location</button>
  <button type="button" class="btn btn-info" id="mybooked-button">My booked</button>
    <button type="button" class="btn btn-info" id="cart-button"> <span class="oi oi-cart"> Cart 0/10</span></button>  <button type="button" class="btn btn-info" id="about-button">About</button>
  Kim JaeYoung (VM/ETO2)</div>
</td>
</table>

<div id='calendar'></div>






<script type="text/javascript">

</script>

</div> <!-- div class='fullcalendar_body' -->
</body>



</html>
